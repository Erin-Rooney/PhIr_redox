---
title: "UTK Cores for Soil Property Analysis"
author: "Erin C Rooney"
date: "2023-04-04"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## UTK cores

packages

```{r, warning=FALSE,message=FALSE,error=FALSE}
knitr::opts_chunk$set(echo = TRUE)

source("code/0-packages.R")

```

data

```{r}
bd_grav_data = read.csv("raw/PhIr2021_Soil_Inventory_bd.csv") 
```

clean data by replacing East/West with acidic tundra and non-acidic tundra. Whenever the Horizon column has an "O", the soil_material column will mark it as organic. Same for "M" and mineral. Calculate vwc from gravimetric and bulk density data.

```{r}
bd_grav_cleaned =
  bd_grav_data %>% 
  #dplyr::select(-c(X)) %>% 
  mutate(Area = recode(Area, "East" = "acidic tundra",
                       "West" = "non-acidic tundra")) %>% 
  dplyr::mutate(soil_material = case_when(grepl("O",Horizon)~"organic",
                                          grepl("M",Horizon)~"mineral")) %>% 
  mutate(volumetric_water_content_cm3_cm3 = soil_bulk_density_g_cm3 * grav_water_gh20_per_gdrysoil) 

```

reduce data columns, create levels for Horizon data (now the label column).

```{r}

bd_select = 
  bd_grav_cleaned %>% 
  dplyr::select(Sample_ID, Core_ID, Date_collected, Area, Site, Plot_num, Plot_ID, 
                Horizon, Depth_1_cm, Depth_2_cm, Depth_3_cm, Depth_4_cm, Average_Depth_cm, real_depth_cm, 
                soil_bulk_density_g_cm3, volumetric_water_content_cm3_cm3, soil_material) %>% 
  mutate(label = Horizon) %>% 
  mutate(label = factor(label, levels = c("O", "O1", "O2", "O3", "M", "M1", "M2")))  
 
```

Differentiate data that has been analyzed for vwc/bulk density and data that hasn't. Replacing all NAs with "Not Analyzed", while true, creates issues for the depth column (switching data type from numeric to character). So that will be fixed later when plotting.

```{r}
sample_status =
  bd_select %>% 
  replace(is.na(.),"not analyzed")  %>% 
  mutate(data = case_when(grepl("not analyzed", soil_bulk_density_g_cm3) ~ "not analyzed", TRUE ~ "analyzed")) 

```

## Analyzed vs Not Analyzed Sample Distributions

```{r, fig.height = 8, fig.width = 5}

sample_status %>% 
  filter(data %in% "analyzed" & real_depth_cm != "not analyzed") %>% 
  mutate(Site = factor(Site, levels = c("Dry", "Mesic", "Hydric", "Transect"))) %>% 
  mutate(Area = factor(Area, levels = c("non-acidic tundra", "acidic tundra"))) %>% 
  mutate(real_depth_cm = as.numeric(real_depth_cm)) %>% 
  mutate(Date_collected = factor(Date_collected, levels = c("6-Jul-21", "7-Jul-21", "13-Jul-21", "14-Jul-21", "24-Jul-21", "30-Jul-21", 
                                                            "31-Jul-21", "7-Aug-21"))) %>% 
  ggplot()+
  geom_point(aes(x = Date_collected, y = real_depth_cm, fill = data), shape = c(21), size = 3, alpha = 0.5)+
  scale_fill_manual(values = c("#efc3e6"))+
  labs(x = "date collected",
       y = "depth",
       fill = "bulk density & volumetric water")+
  facet_grid(Site~Area, scales = "free")+
  scale_y_reverse()+
  theme_er1()+
  theme(axis.text.x = element_text (vjust = 0.5, hjust=1, angle = 90, size = 9), legend.position = "top",
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank())


```

```{r, fig.height = 8, fig.width = 5}
sample_status %>% 
  filter(data %in% "not analyzed" & real_depth_cm != "not analyzed") %>% 
  mutate(Site = factor(Site, levels = c("Dry", "Mesic", "Hydric", "Transect"))) %>% 
  mutate(Area = factor(Area, levels = c("non-acidic tundra", "acidic tundra"))) %>% 
  mutate(real_depth_cm = as.numeric(real_depth_cm)) %>% 
  mutate(Date_collected = factor(Date_collected, levels = c("6-Jul-21", "7-Jul-21", "13-Jul-21", "14-Jul-21", "24-Jul-21", "30-Jul-21", 
                                                            "31-Jul-21", "7-Aug-21"))) %>% 
  ggplot()+
  geom_point(aes(x = Date_collected, y = real_depth_cm, fill = data), shape = c(21), size = 3, alpha = 0.5)+
  scale_fill_manual(values = c("#b8bedd"))+
  labs(x = "date collected",
       y = "depth",
       fill = "bulk density & volumetric water")+
  facet_grid(Site~Area, scales = "free")+
  scale_y_reverse()+
  theme_er1()+
  theme(axis.text.x = element_text (vjust = 0.5, hjust=1, angle = 90, size = 9), legend.position = "top",
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank())
```

## Sample counts

Analyzed vs not analyzed
```{r}

ncount =
  sample_status %>% 
  group_by(data) %>%
  dplyr::summarise(n = n())

print(ncount)


```

Analyzed vs not analyzed by date

```{r}
ncount_bydate =
  sample_status %>% 
  group_by(Date_collected, data) %>%
  dplyr::summarise(n = n())

print(ncount_bydate)
```

By site

```{r}
ncount_bysite =
  sample_status %>% 
  group_by(Area, Site, data) %>%
  dplyr::summarise(n = n())

print(ncount_bysite)
```

By soil material

```{r}
ncount_bymaterial =
  sample_status %>% 
  group_by(soil_material, data) %>%
  dplyr::summarise(n = n())

print(ncount_bymaterial)
```

By Horizon

```{r}
ncount_byhorizon =
  sample_status %>% 
  group_by(Horizon, data) %>%
  dplyr::summarise(n = n())

print(ncount_byhorizon)
```

